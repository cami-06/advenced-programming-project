from abc import ABC , abstractmethod
class basescanner(ABC):
    def __init__(self,http_client,logger):
        self.http=http_client
        self.logger=logger
    @abstractmethod
    def loadpayloads(self):  #charger depuis.txt
        pass

    @abstractmethod
    def generatetest(self):  #ajouter chaque payload de loadpayload dans les parametres d URL, POST, headers, cookies..
        pass    
    @abstractmethod
    def analysereponse(self,reponse):  #si la reponse indique une vulnérabilite ex r=erreur donc vulnerable
        pass
    def scan(self,url):
        self.logger.info(f"[scan] {self.__class__.__name__} -{url}")
        payloads=self.generatetest()
        for payload in payloads:
            response = self.http.send(url, payload) #Envoyer la requête HTTP resultat objet reponse

            if self.analyze_response(response):
                return {
                    "url": url,
                    "payload": payload,
                    "scanner": self.__class__.__name__,
                    "vulnerable": True
                }
        
        return {
            "url": url,
            "payload": payload,
            "scanner": self.__class__.__name__,
            "vulnerable": True
        }
                

